<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>Learn to Decode</title>

    <style>
    body {
      font-family: monospace;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    .navbar-brand {
      font-weight: bold;
    }
    #main {
      position: relative;
    }
    </style>
  </head>
  <body>
    <style id="dynamic-styles"></style>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">Learn to Decode</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lessons
            </a>
            <div id="lessons" class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link reset" href="#">Reset</a>
          </li>
        </ul>
      </div>
    </nav>

    <div id="main">
    </div>

    <script>
      const snap = 50;

      function mousedown_handler(event) {

        const target = event.currentTarget;

        if (target.isTemplate) {
          target.isTemplate = false;
          let newClone = target.cloneNode(true);
          newClone.addEventListener("mousedown", mousedown_handler);
          newClone.isTemplate = true;
          target.classList.add("added");
          document.getElementById("main").appendChild(newClone);
        }

        let shiftX = event.clientX - target.getBoundingClientRect().left;
        let shiftY = event.clientY - target.getBoundingClientRect().top;

        target.style.position = 'absolute';
        target.style.zIndex = 1000;
        document.body.append(target);

        moveAt(event.pageX, event.pageY);

        function moveAt(pageX, pageY) {
          target.style.left = pageX - shiftX + 'px';
          target.style.top = pageY - shiftY + 'px';
        }

        function onMouseMove(event) {
          if (event.pageX - 10 <= 0 ||
              event.pageX + 10 >= document.documentElement.clientWidth ||
              event.pageY + 10 >= document.documentElement.clientHeight) {
            document.removeEventListener('mousemove', onMouseMove);
            target.onmouseup = null;
            target.remove();
            return;
          }

          moveAt(event.pageX, event.pageY);
        }

        document.addEventListener('mousemove', onMouseMove);

        target.onmouseup = function(event) {
          document.removeEventListener('mousemove', onMouseMove);
          target.onmouseup = null;

          const left = (event.pageX - shiftX) - ((event.pageX - shiftX) % snap);
          const top = (event.pageY - shiftY) - ((event.pageY - shiftY) % snap);

          target.style.left = left + 'px';
          target.style.top = top + 'px';

          if (left < 0 ||
              top + target.offsetHeight > document.documentElement.clientHeight ||
              left + target.offsetWidth > document.documentElement.clientWidth
          ) {
            target.remove();
          }
        };

      };

      const fillTemplate = function(template, data){
        const val = (new Function("return `"+template +"`;").call(data));
        return val;
      }

      const createElement = function(template, data) {
        const html = fillTemplate(template, data);
        const div = document.createElement('div');
        div.innerHTML = html;
        return div.children[0];
      }

      const keypress_handler = function(event) {
        console.log(event.code);

        if (event.code === "KeyC" && event.ctrlKey) {
          removeAdded();
        }
      }

      const reset_handler = function(event) {
        removeAdded();
      }

      const removeAdded = function() {
        const added = document.getElementsByClassName("added");
        while (added.length > 0) {
          added[0].remove();
        }
      }

      const loadLesson = function(name) {
        removeAdded();

        const main = document.getElementById("main");
        main.innerHTML = "";
        const template = templates["tile-template"].content;

        const data = lessons[name].data;

        for (let i = 0; i < data.length; i++) {
          const child = createElement(template, data[i]);
          child.isTemplate = true;
          main.appendChild(child);
        }

        const elements = document.getElementsByClassName('shape');
        for (let i = 0; i < elements.length; i++) {
          elements[i].addEventListener("mousedown", mousedown_handler);
        }
      }

      const dropdownItem_handler = function(event) {
        loadLesson(event.currentTarget.text);
      }

      window.addEventListener('DOMContentLoaded', () => {
        for (let i = 0; i < css.length; i++) {
          const styleElement = document.createElement("style");
          styleElement.innerHTML = css[i].content;
          document.getElementsByTagName("head")[0].appendChild(styleElement);
        }

        const keys = Object.keys(lessons);
        for (let i = 0; i < keys.length; i++) {
          const template = '<a class="dropdown-item" href="#">${this.lesson}</a>';
          const element = createElement(template, {"lesson": keys[i]});
          document.getElementById("lessons").appendChild(element);
        }

        let items = document.getElementsByClassName("dropdown-item");
        for (let i = 0; i < items.length; i++) {
          items[i].addEventListener("click", dropdownItem_handler);
        }

        items = document.getElementsByClassName("reset");
        for (let i = 0; i < items.length; i++) {
          items[i].addEventListener("click", reset_handler);
        }

        document.addEventListener('keypress', keypress_handler);
      });

      const css = [
        {
          "content":  ".shape {\n" +
                      "  border: 1px solid #aaaaaa;\n" +
                      "  margin: 2px;\n" +
                      "  border-radius: 8px;\n" +
                      "  position: absolute;\n" +
                      "}\n" +
                      "\n" +
                      ".shape .content {\n" +
                      "  position: relative;\n" +
                      "  top: 50%;\n" +
                      "  transform: translateY(-50%);\n" +
                      "  margin: 0 auto;\n" +
                      "  text-align: center;\n" +
                      "\n" +
                      "  font-size: 40px;\n" +
                      "}\n"
        },
        {
          "content":  ".blue {\n" +
                      "  background: #b2e1ff; /* Old browsers */\n" +
                      "  background: -moz-linear-gradient(top,  #b2e1ff 0%, #66b6fc 100%); /* FF3.6-15 */\n" +
                      "  background: -webkit-linear-gradient(top,  #b2e1ff 0%,#66b6fc 100%); /* Chrome10-25,Safari5.1-6 */\n" +
                      "  background: linear-gradient(to bottom,  #b2e1ff 0%,#66b6fc 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\n" +
                      "  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#b2e1ff', endColorstr='#66b6fc',GradientType=0 ); /* IE6-9 */\n" +
                      "}\n" +
                      ".orange {\n" +
                      "  background: #fac695; /* Old browsers */\n" +
                      "  background: -moz-linear-gradient(top,  #fac695 0%, #f5ab66 47%, #ef8d31 100%); /* FF3.6-15 */\n" +
                      "  background: -webkit-linear-gradient(top,  #fac695 0%,#f5ab66 47%,#ef8d31 100%); /* Chrome10-25,Safari5.1-6 */\n" +
                      "  background: linear-gradient(to bottom,  #fac695 0%,#f5ab66 47%,#ef8d31 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\n" +
                      "  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fac695', endColorstr='#ef8d31',GradientType=0 ); /* IE6-9 */\n" +
                      "}\n" +
                      "\n" +
                      ".red {\n" +
                      "  background: #cc0000; /* Old browsers */\n" +
                      "  background: -moz-linear-gradient(top,  #cc0000 0%, #cc0000 100%); /* FF3.6-15 */\n" +
                      "  background: -webkit-linear-gradient(top,  #cc0000 0%,#cc0000 100%); /* Chrome10-25,Safari5.1-6 */\n" +
                      "  background: linear-gradient(to bottom,  #cc0000 0%,#cc0000 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\n" +
                      "  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#cc0000', endColorstr='#cc0000',GradientType=0 ); /* IE6-9 */\n" +
                      "}\n" +
                      "\n" +
                      ".yellow {\n" +
                      "  background: #ffff88; /* Old browsers */\n" +
                      "  background: -moz-linear-gradient(top,  #ffff88 0%, #ffff88 100%); /* FF3.6-15 */\n" +
                      "  background: -webkit-linear-gradient(top,  #ffff88 0%,#ffff88 100%); /* Chrome10-25,Safari5.1-6 */\n" +
                      "  background: linear-gradient(to bottom,  #ffff88 0%,#ffff88 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\n" +
                      "  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffff88', endColorstr='#ffff88',GradientType=0 ); /* IE6-9 */\n" +
                      "}\n" +
                      "\n" +
                      ".green {\n" +
                      "  background: #b4df5b; /* Old browsers */\n" +
                      "  background: -moz-linear-gradient(top,  #b4df5b 0%, #b4df5b 100%); /* FF3.6-15 */\n" +
                      "  background: -webkit-linear-gradient(top,  #b4df5b 0%,#b4df5b 100%); /* Chrome10-25,Safari5.1-6 */\n" +
                      "  background: linear-gradient(to bottom,  #b4df5b 0%,#b4df5b 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\n" +
                      "  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#b4df5b', endColorstr='#b4df5b',GradientType=0 ); /* IE6-9 */\n" +
                      "}\n"
        }
      ]

      const templates = {
        "tile-template": {
          "content":  '<div class="shape ${this.color}" style="top: ${this.top}; left: ${this.left}; width: ${this.width}; height: ${this.height}">\n' +
                      '  <div class="content">\n' +
                      '    ${this.content}\n' +
                      '  </div>\n' +
                      '</div>'
        }
      }

      const lessons = {
        "Lesson 1": {
          data: [
            {
              "color": "orange",
              "content": "",
              "left": "0px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "",
              "left": "110px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "red",
              "content": "",
              "left": "220px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "yellow",
              "content": "",
              "left": "330px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "green",
              "content": "",
              "left": "440px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
          ]
        },
        "Lesson 2": {
          data : [
            {
              "color": "blue",
              "content": "th",
              "left": "110px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "sh",
              "left": "220px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "ch",
              "left": "330px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "ck",
              "left": "440px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "wh",
              "left": "550px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "tch",
              "left": "660px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "a",
              "left": "0px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "b",
              "left": "110px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "c",
              "left": "220px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "d",
              "left": "330px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "e",
              "left": "440px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "f",
              "left": "550px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "g",
              "left": "660px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "h",
              "left": "770px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "i",
              "left": "880px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "j",
              "left": "990px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "k",
              "left": "1100px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "l",
              "left": "1210px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "m",
              "left": "1320px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },

            {
              "color": "blue",
              "content": "n",
              "left": "0px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "o",
              "left": "110px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "p",
              "left": "220px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "qu",
              "left": "330px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "r",
              "left": "440px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "s",
              "left": "550px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "t",
              "left": "660px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "u",
              "left": "770px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "v",
              "left": "880px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "w",
              "left": "990px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "x",
              "left": "1100px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "y",
              "left": "1210px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "z",
              "left": "1320px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            }
          ]
        },
        "Lesson 3": {
          data : [
            {
              "color": "blue",
              "content": "th",
              "left": "110px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "sh",
              "left": "220px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "ch",
              "left": "330px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "ck",
              "left": "440px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "wh",
              "left": "550px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "tch",
              "left": "660px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            }
          ]
        },
        "Lesson 4": {
          data: [
            {
              "color": "orange",
              "content": "a",
              "left": "0px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "e",
              "left": "110px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "i",
              "left": "220px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "o",
              "left": "330px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "u",
              "left": "440px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            }
          ]
        }
      }
    </script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>  </body>
</html>
