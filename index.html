<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>Learn to Decode</title>

    <style>
    body {
      font-family: monospace;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    .navbar-brand {
      font-weight: bold;
    }
    #main {
      position: relative;
    }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">Learn to Decode</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Lessons
            </a>
            <div id="lessons" class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link reset" href="#">Reset</a>
          </li>
        </ul>
      </div>
    </nav>

    <div id="main">
    </div>

    <script>
      const snap = 50;

      function mousedown_handler(event) {

        const target = event.currentTarget;

        if (target.isTemplate) {
          target.isTemplate = false;
          let newClone = target.cloneNode(true);
          newClone.addEventListener("mousedown", mousedown_handler);
          newClone.isTemplate = true;
          target.classList.add("added");
          document.getElementById("main").appendChild(newClone);
        }

        let shiftX = event.clientX - target.getBoundingClientRect().left;
        let shiftY = event.clientY - target.getBoundingClientRect().top;

        target.style.position = 'absolute';
        target.style.zIndex = 1000;
        document.body.append(target);

        moveAt(event.pageX, event.pageY);

        function moveAt(pageX, pageY) {
          target.style.left = pageX - shiftX + 'px';
          target.style.top = pageY - shiftY + 'px';
        }

        function onMouseMove(event) {
          if (event.pageX - 10 <= 0 ||
              event.pageX + 10 >= document.documentElement.clientWidth ||
              event.pageY + 10 >= document.documentElement.clientHeight) {
            document.removeEventListener('mousemove', onMouseMove);
            target.onmouseup = null;
            target.remove();
            return;
          }

          moveAt(event.pageX, event.pageY);
        }

        document.addEventListener('mousemove', onMouseMove);

        target.onmouseup = function(event) {
          document.removeEventListener('mousemove', onMouseMove);
          target.onmouseup = null;

          const left = (event.pageX - shiftX) - ((event.pageX - shiftX) % snap);
          const top = (event.pageY - shiftY) - ((event.pageY - shiftY) % snap);

          target.style.left = left + 'px';
          target.style.top = top + 'px';

          if (left < 0 ||
              top + target.offsetHeight > document.documentElement.clientHeight ||
              left + target.offsetWidth > document.documentElement.clientWidth
          ) {
            target.remove();
          }
        };

      };

      const fillTemplate = function(template, data){
        const val = (new Function("return `"+template +"`;").call(data));
        return val;
      }

      const createElement = function(template, data) {
        const html = fillTemplate(template, data);
        const div = document.createElement('div');
        div.innerHTML = html;
        return div.children[0];
      }

      const keypress_handler = function(event) {
        console.log(event.code);

        if (event.code === "KeyC" && event.ctrlKey) {
          removeAdded();
        }
      }

      const reset_handler = function(event) {
        removeAdded();
      }

      const removeAdded = function() {
        const added = document.getElementsByClassName("added");
        while (added.length > 0) {
          added[0].remove();
        }
      }

      const loadLesson = function(name) {
        removeAdded();

        const main = document.getElementById("main");
        main.innerHTML = "";
        const template = templates["tile-template"].content;

        const data = lessons[name].data;

        for (let i = 0; i < data.length; i++) {
          const child = createElement(template, data[i]);
          child.isTemplate = true;
          main.appendChild(child);
        }

        const elements = document.getElementsByClassName('shape');
        for (let i = 0; i < elements.length; i++) {
          elements[i].addEventListener("mousedown", mousedown_handler);
        }
      }

      const dropdownItem_handler = function(event) {
        loadLesson(event.currentTarget.text);
      }

      window.addEventListener('DOMContentLoaded', () => {
        for (let i = 0; i < css.length; i++) {
          const styleElement = document.createElement("style");
          styleElement.innerHTML = css[i].content;
          document.getElementsByTagName("head")[0].appendChild(styleElement);
        }

        const keys = Object.keys(lessons);
        for (let i = 0; i < keys.length; i++) {
          const template = '<a class="dropdown-item" href="#">${this.lesson}</a>';
          const element = createElement(template, {"lesson": keys[i]});
          document.getElementById("lessons").appendChild(element);
        }

        let items = document.getElementsByClassName("dropdown-item");
        for (let i = 0; i < items.length; i++) {
          items[i].addEventListener("click", dropdownItem_handler);
        }

        items = document.getElementsByClassName("reset");
        for (let i = 0; i < items.length; i++) {
          items[i].addEventListener("click", reset_handler);
        }

        document.addEventListener('keypress', keypress_handler);
      });

      const css = [
        {
          "content":  ".shape {\n" +
                      "  border: 1px solid #aaaaaa;\n" +
                      "  margin: 2px;\n" +
                      "  border-radius: 8px;\n" +
                      "  position: absolute;\n" +
                      "}\n" +
                      ".shape .content {\n" +
                      "  position: relative;\n" +
                      "  top: 50%;\n" +
                      "  transform: translateY(-50%);\n" +
                      "  margin: 0 auto;\n" +
                      "  text-align: center;\n" +
                      "  font-size: 40px;\n" +
                      "}\n"
        },
        {
          "content":  ".blue {\n" +
                      "  background: #b2e1ff; /* Old browsers */\n" +
                      "  background: -moz-linear-gradient(top,  #b2e1ff 0%, #66b6fc 100%); /* FF3.6-15 */\n" +
                      "  background: -webkit-linear-gradient(top,  #b2e1ff 0%,#66b6fc 100%); /* Chrome10-25,Safari5.1-6 */\n" +
                      "  background: linear-gradient(to bottom,  #b2e1ff 0%,#66b6fc 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\n" +
                      "  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#b2e1ff', endColorstr='#66b6fc',GradientType=0 ); /* IE6-9 */\n" +
                      "}\n" +
                      ".orange {\n" +
                      "  background: #fac695; /* Old browsers */\n" +
                      "  background: -moz-linear-gradient(top,  #fac695 0%, #f5ab66 47%, #ef8d31 100%); /* FF3.6-15 */\n" +
                      "  background: -webkit-linear-gradient(top,  #fac695 0%,#f5ab66 47%,#ef8d31 100%); /* Chrome10-25,Safari5.1-6 */\n" +
                      "  background: linear-gradient(to bottom,  #fac695 0%,#f5ab66 47%,#ef8d31 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\n" +
                      "  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fac695', endColorstr='#ef8d31',GradientType=0 ); /* IE6-9 */\n" +
                      "}\n" +
                      "\n" +
                      ".red {\n" +
                      "  background: #cc0000; /* Old browsers */\n" +
                      "  background: -moz-linear-gradient(top,  #cc0000 0%, #cc0000 100%); /* FF3.6-15 */\n" +
                      "  background: -webkit-linear-gradient(top,  #cc0000 0%,#cc0000 100%); /* Chrome10-25,Safari5.1-6 */\n" +
                      "  background: linear-gradient(to bottom,  #cc0000 0%,#cc0000 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\n" +
                      "  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#cc0000', endColorstr='#cc0000',GradientType=0 ); /* IE6-9 */\n" +
                      "}\n" +
                      "\n" +
                      ".yellow {\n" +
                      "  background: #ffff88; /* Old browsers */\n" +
                      "  background: -moz-linear-gradient(top,  #ffff88 0%, #ffff88 100%); /* FF3.6-15 */\n" +
                      "  background: -webkit-linear-gradient(top,  #ffff88 0%,#ffff88 100%); /* Chrome10-25,Safari5.1-6 */\n" +
                      "  background: linear-gradient(to bottom,  #ffff88 0%,#ffff88 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\n" +
                      "  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffff88', endColorstr='#ffff88',GradientType=0 ); /* IE6-9 */\n" +
                      "}\n" +
                      "\n" +
                      ".green {\n" +
                      "  background: #b4df5b; /* Old browsers */\n" +
                      "  background: -moz-linear-gradient(top,  #b4df5b 0%, #b4df5b 100%); /* FF3.6-15 */\n" +
                      "  background: -webkit-linear-gradient(top,  #b4df5b 0%,#b4df5b 100%); /* Chrome10-25,Safari5.1-6 */\n" +
                      "  background: linear-gradient(to bottom,  #b4df5b 0%,#b4df5b 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */\n" +
                      "  filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#b4df5b', endColorstr='#b4df5b',GradientType=0 ); /* IE6-9 */\n" +
                      "}\n"
        },
        {
          "content":  ".circle {\n" +
                      "  width: 80px;\n" +
                      "  height: 80px;\n" +
                      "  background: black;\n" +
                      "  border-radius: 50%;\n" +
                      "  margin: 0 auto;\n" +
                      "}\n" +
                      ".square {\n" +
                      "  width: 80px;\n" +
                      "  height: 80px;\n" +
                      "  background: black;\n" +
                      "  margin: 0 auto;\n" +
                      "}\n" +
                      ".triangle {\n" +
                      "  width: 0;\n" +
                      "  height: 0;\n" +
                      "  border-left: 40px solid transparent;\n" +
                      "  border-right: 40px solid transparent;\n" +
                      "  border-bottom: 80px solid black;\n" +
                      "  margin: 0 auto;\n" +
                      "}\n"+
                      ".pacman {\n" +
                      "  width: 0px;\n" +
                      "  height: 0px;\n" +
                      "  border-right: 40px solid transparent;\n" +
                      "  border-top: 40px solid black;\n" +
                      "  border-left: 40px solid black;\n" +
                      "  border-bottom: 40px solid black;\n" +
                      "  border-top-left-radius: 40px;\n" +
                      "  border-top-right-radius: 40px;\n" +
                      "  border-bottom-left-radius: 40px;\n" +
                      "  border-bottom-right-radius: 40px;\n" +
                      "  margin: 0 auto;\n" +
                      "}\n" +
                      ".bi.bi-alarm {\n" +
                      "  transform: scale(4, 4);\n" +
                      "}\n" +
                      ".bi.bi-binoculars-fill {\n" +
                      "  transform: scale(4, 4);\n" +
                      "}\n"
        }
      ]

      const templates = {
        "tile-template": {
          "content":  '<div class="shape ${this.classes ? this.classes : ""} ${this.color}"\n' +
                      '   style="top: ${this.top}; left: ${this.left}; width: ${this.width}; height: ${this.height}">\n' +
                      '  <div class="content">\n' +
                      '    ${this.content ? this.content : ""}\n' +
                      '  </div>\n' +
                      '</div>'
        }
      }

      const lessons = {
        "Lesson 1": {
          data: [
            {
              "color": "orange",
              "content": "",
              "left": "0px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "",
              "left": "110px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "red",
              "content": "",
              "left": "220px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "yellow",
              "content": "",
              "left": "330px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "green",
              "content": "",
              "left": "440px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "<div class='circle'></div>",
              "left": "0px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "<div class='square'></div>",
              "left": "110px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "red",
              "content":  '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-binoculars-fill" viewBox="0 0 16 16">\n' +
                          '  <path d="M4.5 1A1.5 1.5 0 0 0 3 2.5V3h4v-.5A1.5 1.5 0 0 0 5.5 1h-1zM7 4v1h2V4h4v.882a.5.5 0 0 0 .276.447l.895.447A1.5 1.5 0 0 1 15 7.118V13H9v-1.5a.5.5 0 0 1 .146-.354l.854-.853V9.5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v.793l.854.853A.5.5 0 0 1 7 11.5V13H1V7.118a1.5 1.5 0 0 1 .83-1.342l.894-.447A.5.5 0 0 0 3 4.882V4h4zM1 14v.5A1.5 1.5 0 0 0 2.5 16h3A1.5 1.5 0 0 0 7 14.5V14H1zm8 0v.5a1.5 1.5 0 0 0 1.5 1.5h3a1.5 1.5 0 0 0 1.5-1.5V14H9zm4-11H9v-.5A1.5 1.5 0 0 1 10.5 1h1A1.5 1.5 0 0 1 13 2.5V3z"/>\n' +
                          '</svg>\n',
              "left": "220px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "yellow",
              "content":  '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-alarm" viewBox="0 0 16 16">\n' +
                          '  <path d="M8.5 5.5a.5.5 0 0 0-1 0v3.362l-1.429 2.38a.5.5 0 1 0 .858.515l1.5-2.5A.5.5 0 0 0 8.5 9V5.5z"/>\n' +
                          '  <path d="M6.5 0a.5.5 0 0 0 0 1H7v1.07a7.001 7.001 0 0 0-3.273 12.474l-.602.602a.5.5 0 0 0 .707.708l.746-.746A6.97 6.97 0 0 0 8 16a6.97 6.97 0 0 0 3.422-.892l.746.746a.5.5 0 0 0 .707-.708l-.601-.602A7.001 7.001 0 0 0 9 2.07V1h.5a.5.5 0 0 0 0-1h-3zm1.038 3.018a6.093 6.093 0 0 1 .924 0 6 6 0 1 1-.924 0zM0 3.5c0 .753.333 1.429.86 1.887A8.035 8.035 0 0 1 4.387 1.86 2.5 2.5 0 0 0 0 3.5zM13.5 1c-.753 0-1.429.333-1.887.86a8.035 8.035 0 0 1 3.527 3.527A2.5 2.5 0 0 0 13.5 1z"/>\n' +
                          '</svg>\n',
              "left": "330px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "green",
              "content": "<div class='pacman'></div>",
              "left": "440px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            }
          ]
        },
        "Lesson 2": {
          data : [
            {
              "color": "blue",
              "content": "th",
              "left": "110px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "sh",
              "left": "220px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "ch",
              "left": "330px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "ck",
              "left": "440px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "wh",
              "left": "550px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "tch",
              "left": "660px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "a",
              "left": "0px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "b",
              "left": "110px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "c",
              "left": "220px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "d",
              "left": "330px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "e",
              "left": "440px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "f",
              "left": "550px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "g",
              "left": "660px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "h",
              "left": "770px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "i",
              "left": "880px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "j",
              "left": "990px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "k",
              "left": "1100px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "l",
              "left": "1210px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "m",
              "left": "1320px",
              "top": "120px",
              "width": "100px",
              "height": "100px"
            },

            {
              "color": "blue",
              "content": "n",
              "left": "0px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "o",
              "left": "110px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "p",
              "left": "220px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "qu",
              "left": "330px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "r",
              "left": "440px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "s",
              "left": "550px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "t",
              "left": "660px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "u",
              "left": "770px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "v",
              "left": "880px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "w",
              "left": "990px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "x",
              "left": "1100px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "y",
              "left": "1210px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "z",
              "left": "1320px",
              "top": "230px",
              "width": "100px",
              "height": "100px"
            }
          ]
        },
        "Lesson 3": {
          data : [
            {
              "color": "blue",
              "content": "th",
              "left": "110px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "sh",
              "left": "220px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "ch",
              "left": "330px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "ck",
              "left": "440px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "wh",
              "left": "550px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "blue",
              "content": "tch",
              "left": "660px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            }
          ]
        },
        "Lesson 4": {
          data: [
            {
              "color": "orange",
              "content": "a",
              "left": "0px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "e",
              "left": "110px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "i",
              "left": "220px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "o",
              "left": "330px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            },
            {
              "color": "orange",
              "content": "u",
              "left": "440px",
              "top": "10px",
              "width": "100px",
              "height": "100px"
            }
          ]
        }
      }
    </script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>  </body>
</html>
